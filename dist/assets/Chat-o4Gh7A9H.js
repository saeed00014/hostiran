import{r,j as e,D as f,ae as w,af as b,ag as y,L as j,i as o,g as p,u as v,$ as _,a0 as S,a1 as M,ah as $,O as k,Q as B,ai as E}from"./index-dtjjMVmN.js";import{_ as L,a as C,l as g,G as F,H as P}from"./index.esm-EdaFh0Xs.js";import{c as R}from"./index.esm-QWkCWpCQ.js";const A=({targetUser:s})=>{const[a,t]=r.useState(null);return r.useEffect(()=>{function i(){const l=new URL(Object.assign({"../../../../assets/avatar/1701244621129-ajorphone.png":L,"../../../../assets/avatar/testImg.png":C})[`../../../../assets/avatar/${s&&s[0].avatar}`],import.meta.url).href,m=l.split("/").length,n=l.split("/")[m-1];n!=="undefined"&&t(l),n=="undefined"&&t(null)}i()},[s]),e.jsxs("div",{className:"sticky top-0 flex items-center justify-between w-full min-h-[75px] xl:px-8 md:px-4 px-2 bg-white",children:[e.jsxs("div",{className:"flex items-center w-full gap-3",children:[e.jsx("div",{className:"w-[50px] h-[50px]",children:e.jsx("img",{src:s[0].avatar?`https://saeedwebdev.ir/avatar/${s[0].avatar}`:f,alt:"",className:"w-full h-full rounded-full"})}),e.jsx("span",{className:"-mt-1",children:s&&s[0].firstName+" "+s[0].lastName})]}),e.jsxs("div",{className:"flex gap-4 text-3xl",children:[e.jsx("i",{children:e.jsx(w,{})}),e.jsx("i",{children:e.jsx(b,{})}),e.jsx("i",{children:e.jsx(y,{})})]})]})},H=({message:s,loginUser:a,targetUser:t})=>e.jsxs("div",{className:`flex ${s.user_id==a[0].id?"justify-end":"justify-start gap-2"} min-w-max`,children:[s.user_id!==a[0].id?e.jsx("div",{className:"w-[40px] h-[40px] ",children:e.jsx("img",{src:t[0].avatar?`https://saeedwebdev.ir/avatar/${t[0].avatar}`:f,alt:"",className:"object-cover h-full w-full rounded-full"})}):e.jsx(e.Fragment,{}),e.jsxs("p",{className:`relative max-w-[22rem] px-3 py-2 rounded-[1.5rem] break-words ${s.user_id==(a[0]&&a[0].id)&&a[0].id?"bg-blue-700 text-left text-white":"bg-gray-300"}`,children:[s.user_id==a[0].id&&e.jsx("span",{className:"absolute left-0 -top-4 min-w-max text-black text-[.7rem]",children:a[0]&&a[0].firstName+" "+a[0].lastName}),s.user_id!==a[0].id&&e.jsx("span",{className:"absolute right-3 -top-4 min-w-max text-black text-[.7rem]",children:t[0]&&t[0].firstName+" "+t[0].lastName}),s.text]})]}),D=({targetUser:s})=>e.jsxs("div",{className:"flex flex-col items-center w-full h-full pt-10 gap-2",children:[e.jsx("div",{className:"w-28 h-28",children:e.jsx("img",{src:s[0].avatar?`https://saeedwebdev.ir/avatar/${s[0].avatar}`:f,alt:"",className:"w-full h-full object-cover rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("span",{className:"flex justify-center",children:s&&s[0].firstName+" "+s[0].lastName}),e.jsx(j,{to:`/sma/profile/${s&&s[0].id}`,className:"flex py-2 px-4 bg-bg-hover rounded-[.5rem]",children:"View Profile"})]})]}),G=({targetUser:s,loginUser:a})=>{const i=o(l=>l.ui).allMessages;return e.jsxs("div",{className:"flex flex-col w-full gap-4 pt-4 pb-56",children:[i[0]==""&&e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(g,{color:"black"})}),i[0]==""?"":i[0]=="no message"?e.jsx(D,{targetUser:s}):i.map(l=>e.jsx("span",{children:e.jsx(H,{message:l,loginUser:a,targetUser:s})},l.id))]})},I=s=>p.get(s).then(({data:a})=>a).catch(a=>{console.log(a)}),O=(s,a,t,i)=>p.post(s,{user_id:a,targetUser_id:t,text:i}).then(({data:l})=>l).catch(l=>{console.log(l)}),T=({targetUser:s})=>{const a=r.useRef(),[t,i]=r.useState(""),l=v(),n=o(c=>c.ui).loginUser,u=c=>{c.preventDefault(),i("");const d=a.current.text.value,x="https://saeedwebdev.ir/api/messages";async function N(){const h=s[0]&&n[0]&&await O(x,n[0].id,s[0].id,d);h&&l($(h))}N()};return e.jsxs("form",{onSubmit:c=>u(c),ref:a,className:"relative flex items-center justify-center border-[2px] w-full h-11 rounded-full",children:[e.jsx("input",{onChange:c=>i(c.target.value),value:t,type:"text",name:"text",placeholder:"پیام ...",className:"h-full w-full rounded-full px-12"}),t?e.jsxs("div",{className:"absolute right-3 text-[1.5rem] text-blue-600",children:[e.jsx("label",{htmlFor:"submit",children:e.jsx(_,{})}),e.jsx("input",{type:"submit",id:"submit",className:"hidden"})]}):e.jsx("i",{className:"absolute right-3 text-[1.5rem]",children:e.jsx(S,{})}),e.jsxs("div",{className:"absolute left-6 flex text-[1.5rem] gap-4",children:[e.jsx("i",{children:e.jsx(M,{})}),e.jsx("i",{children:e.jsx(F,{})})]})]})},V=({targetUser:s,loginUser:a})=>e.jsxs("div",{className:"flex flex-col justify-between h-full xl:px-8 md:px-4 px-2",children:[e.jsx("div",{className:"flex h-full overflow-y-scroll",children:e.jsx(G,{targetUser:s,loginUser:a})}),e.jsx("div",{className:"sticky md:bottom-0 bottom-[60px] flex items-center justify-center h-fit py-3",children:e.jsx(T,{targetUser:s})})]}),q=({targetUser:s,loginUser:a})=>e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx(A,{targetUser:s}),e.jsx(V,{targetUser:s,loginUser:a})]}),Q=()=>{const a=o(t=>t.ui).targetUser;return e.jsxs("div",{className:"sticky top-0 flex flex-col items-center w-full bg-white",children:[e.jsxs("div",{className:"flex justify-between w-full px-6 pt-6 pb-4",children:[e.jsx(j,{to:`/sma/chat/${a[0]&&a[0].id}`,children:a[0]&&a[0].firstName+" "+a[0].lastName}),e.jsx("i",{className:"text-2xl",children:e.jsx(R,{})})]}),e.jsxs("div",{className:"flex justify-between w-full px-6 py-2",children:[e.jsx("span",{children:"Messages"}),e.jsx("a",{href:"",children:"Requests"})]})]})},W=({user:s})=>e.jsxs("a",{href:`/sma/chat/${s.id}`,className:"flex items-center py-2 px-6 gap-4 hover:bg-bg-hover",children:[e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:targetUser[0].avatar?`https://saeedwebdev.ir/avatar/${targetUser[0].avatar}`:f,alt:"",className:"w-full h-full rounded-full"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"-mt-1",children:s&&s.firstName+" "+s.lastName}),e.jsx("small",{children:"هیچ پیامی ارسال نشده است ."})]})]}),z=()=>{const s=o(l=>l.ui),a=s.allLoginUsers,t=s.loginUser,i=a&&a.filter(l=>l.id!==t[0].id);return e.jsx("div",{className:"overflow-y-scroll",children:i.map(l=>e.jsx("span",{children:e.jsx(W,{user:l})},l.id))})},J=()=>e.jsxs("div",{className:"lg:flex hidden flex-col min-w-[360px] border-l-[1px] bg-white",children:[e.jsx(Q,{}),e.jsx(z,{})]}),K=()=>{const s=v(),[a,t]=r.useState(),l=o(c=>c.ui).loginUser,n=window.location.href.split("/"),u=n[n.length-1];return r.useEffect(()=>{async function c(){const d=`https://saeedwebdev.ir/api/users/${u}`,x=await k(d);x&&(t(x),s(B(x[0])))}c()},[u]),r.useEffect(()=>{async function c(){const d=a&&l[0]&&await I(`https://saeedwebdev.ir/api/messages/${l[0].id}=${a[0].id}`);d&&s(E(d))}c()},[a]),e.jsx("section",{className:"flex w-full max-h-screen min-h-screen overflow-hidden",children:a&&l?e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(q,{targetUser:a,loginUser:l})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(g,{color:"black"})})})},U=P(K);export{U as default};
