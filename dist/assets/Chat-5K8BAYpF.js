import{r,j as e,D as f,ae as g,af as b,ag as y,L as j,i as o,g as p,u as v,$ as S,a0 as M,a1 as $,ah as k,O as B,Q as E,ai as L}from"./index-CeB6bKrg.js";import{l as N,G as C,H as F}from"./index.esm-ypbHWeUf.js";import{c as P}from"./index.esm--TEPj9-S.js";const R=({targetUser:s})=>{const[l,t]=r.useState(null);return r.useEffect(()=>{function i(){const a=new URL(Object.assign({})[`../../../../assets/avatar/${s&&s[0].avatar}`],import.meta.url).href,m=a.split("/").length,n=a.split("/")[m-1];n!=="undefined"&&t(a),n=="undefined"&&t(null)}i()},[s]),e.jsxs("div",{className:"sticky top-0 flex items-center justify-between w-full min-h-[75px] xl:px-8 md:px-4 px-2 bg-white",children:[e.jsxs("div",{className:"flex items-center w-full gap-3",children:[e.jsx("div",{className:"w-[50px] h-[50px]",children:e.jsx("img",{src:s[0].avatar?`https://saeedwebdev.ir/avatar/${s[0].avatar}`:f,alt:"",className:"w-full h-full rounded-full"})}),e.jsx("span",{className:"-mt-1",children:s&&s[0].firstName+" "+s[0].lastName})]}),e.jsxs("div",{className:"flex gap-4 text-3xl",children:[e.jsx("i",{children:e.jsx(g,{})}),e.jsx("i",{children:e.jsx(b,{})}),e.jsx("i",{children:e.jsx(y,{})})]})]})},_=({message:s,loginUser:l,targetUser:t})=>e.jsxs("div",{className:`flex ${s.user_id==l[0].id?"justify-end":"justify-start gap-2"} min-w-max`,children:[s.user_id!==l[0].id?e.jsx("div",{className:"w-[40px] h-[40px] ",children:e.jsx("img",{src:t[0].avatar?`https://saeedwebdev.ir/avatar/${t[0].avatar}`:f,alt:"",className:"object-cover h-full w-full rounded-full"})}):e.jsx(e.Fragment,{}),e.jsxs("p",{className:`relative max-w-[22rem] px-3 py-2 rounded-[1.5rem] break-words ${s.user_id==(l[0]&&l[0].id)&&l[0].id?"bg-blue-700 text-left text-white":"bg-gray-300"}`,children:[s.user_id==l[0].id&&e.jsx("span",{className:"absolute left-0 -top-4 min-w-max text-black text-[.7rem]",children:l[0]&&l[0].firstName+" "+l[0].lastName}),s.user_id!==l[0].id&&e.jsx("span",{className:"absolute right-3 -top-4 min-w-max text-black text-[.7rem]",children:t[0]&&t[0].firstName+" "+t[0].lastName}),s.text]})]}),A=({targetUser:s})=>e.jsxs("div",{className:"flex flex-col items-center w-full h-full pt-10 gap-2",children:[e.jsx("div",{className:"w-28 h-28",children:e.jsx("img",{src:s[0].avatar?`https://saeedwebdev.ir/avatar/${s[0].avatar}`:f,alt:"",className:"w-full h-full object-cover rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("span",{className:"flex justify-center",children:s&&s[0].firstName+" "+s[0].lastName}),e.jsx(j,{to:`/sma/profile/${s&&s[0].id}`,className:"flex py-2 px-4 bg-bg-hover rounded-[.5rem]",children:"View Profile"})]})]}),H=({targetUser:s,loginUser:l})=>{const i=o(a=>a.ui).allMessages;return e.jsxs("div",{className:"flex flex-col w-full gap-4 pt-4 pb-56",children:[i[0]==""&&e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(N,{color:"black"})}),i[0]==""?"":i[0]=="no message"?e.jsx(A,{targetUser:s}):i.map(a=>e.jsx("span",{children:e.jsx(_,{message:a,loginUser:l,targetUser:s})},a.id))]})},D=s=>p.get(s).then(({data:l})=>l).catch(l=>{console.log(l)}),G=(s,l,t,i)=>p.post(s,{user_id:l,targetUser_id:t,text:i}).then(({data:a})=>a).catch(a=>{console.log(a)}),O=({targetUser:s})=>{const l=r.useRef(),[t,i]=r.useState(""),a=v(),n=o(c=>c.ui).loginUser,u=c=>{c.preventDefault(),i("");const d=l.current.text.value,x="https://saeedwebdev.ir/api/messages";async function w(){const h=s[0]&&n[0]&&await G(x,n[0].id,s[0].id,d);h&&a(k(h))}w()};return e.jsxs("form",{onSubmit:c=>u(c),ref:l,className:"relative flex items-center justify-center border-[2px] w-full h-11 rounded-full",children:[e.jsx("input",{onChange:c=>i(c.target.value),value:t,type:"text",name:"text",placeholder:"پیام ...",className:"h-full w-full rounded-full px-12"}),t?e.jsxs("div",{className:"absolute right-3 text-[1.5rem] text-blue-600",children:[e.jsx("label",{htmlFor:"submit",children:e.jsx(S,{})}),e.jsx("input",{type:"submit",id:"submit",className:"hidden"})]}):e.jsx("i",{className:"absolute right-3 text-[1.5rem]",children:e.jsx(M,{})}),e.jsxs("div",{className:"absolute left-6 flex text-[1.5rem] gap-4",children:[e.jsx("i",{children:e.jsx($,{})}),e.jsx("i",{children:e.jsx(C,{})})]})]})},T=({targetUser:s,loginUser:l})=>e.jsxs("div",{className:"flex flex-col justify-between h-full xl:px-8 md:px-4 px-2",children:[e.jsx("div",{className:"flex h-full overflow-y-scroll",children:e.jsx(H,{targetUser:s,loginUser:l})}),e.jsx("div",{className:"sticky md:bottom-0 bottom-[60px] flex items-center justify-center h-fit py-3",children:e.jsx(O,{targetUser:s})})]}),I=({targetUser:s,loginUser:l})=>e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx(R,{targetUser:s}),e.jsx(T,{targetUser:s,loginUser:l})]}),V=()=>{const l=o(t=>t.ui).targetUser;return e.jsxs("div",{className:"sticky top-0 flex flex-col items-center w-full bg-white",children:[e.jsxs("div",{className:"flex justify-between w-full px-6 pt-6 pb-4",children:[e.jsx(j,{to:`/sma/chat/${l[0]&&l[0].id}`,children:l[0]&&l[0].firstName+" "+l[0].lastName}),e.jsx("i",{className:"text-2xl",children:e.jsx(P,{})})]}),e.jsxs("div",{className:"flex justify-between w-full px-6 py-2",children:[e.jsx("span",{children:"Messages"}),e.jsx("a",{href:"",children:"Requests"})]})]})},q=({user:s})=>e.jsxs("a",{href:`/sma/chat/${s.id}`,className:"flex items-center py-2 px-6 gap-4 hover:bg-bg-hover",children:[e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:targetUser[0].avatar?`https://saeedwebdev.ir/avatar/${targetUser[0].avatar}`:f,alt:"",className:"w-full h-full rounded-full"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"-mt-1",children:s&&s.firstName+" "+s.lastName}),e.jsx("small",{children:"هیچ پیامی ارسال نشده است ."})]})]}),Q=()=>{const s=o(a=>a.ui),l=s.allLoginUsers,t=s.loginUser,i=l&&l.filter(a=>a.id!==t[0].id);return e.jsx("div",{className:"overflow-y-scroll",children:i.map(a=>e.jsx("span",{children:e.jsx(q,{user:a})},a.id))})},W=()=>e.jsxs("div",{className:"lg:flex hidden flex-col min-w-[360px] border-l-[1px] bg-white",children:[e.jsx(V,{}),e.jsx(Q,{})]}),z=()=>{const s=v(),[l,t]=r.useState(),a=o(c=>c.ui).loginUser,n=window.location.href.split("/"),u=n[n.length-1];return r.useEffect(()=>{async function c(){const d=`https://saeedwebdev.ir/api/users/${u}`,x=await B(d);x&&(t(x),s(E(x[0])))}c()},[u]),r.useEffect(()=>{async function c(){const d=l&&a[0]&&await D(`https://saeedwebdev.ir/api/messages/${a[0].id}=${l[0].id}`);d&&s(L(d))}c()},[l]),e.jsx("section",{className:"flex w-full max-h-screen min-h-screen overflow-hidden",children:l&&a?e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx(I,{targetUser:l,loginUser:a})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(N,{color:"black"})})})},Y=F(z);export{Y as default};
