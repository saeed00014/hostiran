import{r,j as e,C as m,ad as w,ae as b,af as y,_ as h,L as j,i as f,g,u as v,Z as S,$ as M,a0 as $,ag as L,K as _,N as E,ah as B}from"./index-jPYsPHAl.js";import{G as k,H as C}from"./index.esm-8vq6tBXO.js";import{c as I}from"./index.esm-1ArtJBQN.js";const R=({targetUser:s})=>{const[t,a]=r.useState(null);return r.useEffect(()=>{function i(){const l=new URL(Object.assign({"../../../../assets/avatar/testImg.png":h})[`../../../../assets/avatar/${s&&s[0].avatar}`],import.meta.url).href,d=l.split("/").length,n=l.split("/")[d-1];n!=="undefined"&&a(l),n=="undefined"&&a(null)}i()},[s]),e.jsxs("div",{className:"sticky top-0 flex items-center justify-between w-full min-h-[75px] xl:px-8 md:px-4 px-2 bg-white",children:[e.jsxs("div",{className:"flex items-center w-full gap-3",children:[e.jsx("div",{className:"w-[50px] h-[50px]",children:e.jsx("img",{src:t||m,alt:"",className:"w-full h-full rounded-full"})}),e.jsx("span",{className:"-mt-1",children:s&&s[0].firstName+" "+s[0].lastName})]}),e.jsxs("div",{className:"flex gap-4 text-3xl",children:[e.jsx("i",{children:e.jsx(w,{})}),e.jsx("i",{children:e.jsx(b,{})}),e.jsx("i",{children:e.jsx(y,{})})]})]})},A=({message:s,loginUser:t,targetUser:a,avatar:i})=>e.jsxs("div",{className:`flex ${s.user_id==t[0].id?"justify-end":"justify-start gap-2"} min-w-max`,children:[s.user_id!==t[0].id?e.jsx("div",{className:"w-[40px] h-[40px] ",children:e.jsx("img",{src:i||m,alt:"",className:"object-cover h-full w-full rounded-full"})}):e.jsx(e.Fragment,{}),e.jsxs("p",{className:`relative max-w-[22rem] px-3 py-2 rounded-[1.5rem] break-words ${s.user_id==(t[0]&&t[0].id)&&t[0].id?"bg-blue-700 text-left text-white":"bg-gray-300"}`,children:[s.user_id==t[0].id&&e.jsx("span",{className:"absolute left-0 -top-4 min-w-max text-black text-[.7rem]",children:t[0]&&t[0].firstName+" "+t[0].lastName}),s.user_id!==t[0].id&&e.jsx("span",{className:"absolute right-3 -top-4 min-w-max text-black text-[.7rem]",children:a[0]&&a[0].firstName+" "+a[0].lastName}),s.text]})]}),F=({targetUser:s,avatar:t})=>e.jsxs("div",{className:"flex flex-col items-center w-full h-full pt-10 gap-2",children:[e.jsx("div",{className:"w-28 h-28",children:e.jsx("img",{src:t||m,alt:"",className:"w-full h-full object-cover rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("span",{className:"flex justify-center",children:s&&s[0].firstName+" "+s[0].lastName}),e.jsx(j,{to:`/sma/profile/${s&&s[0].id}`,className:"flex py-2 px-4 bg-bg-hover rounded-[.5rem]",children:"View Profile"})]})]}),P=({targetUser:s,loginUser:t})=>{const i=f(n=>n.ui).allMessages,[l,d]=r.useState(null);return r.useEffect(()=>{function n(){const x=new URL(Object.assign({"../../../../assets/avatar/testImg.png":h})[`../../../../assets/avatar/${s&&s[0].avatar}`],import.meta.url).href,c=x.split("/").length,o=x.split("/")[c-1];o!=="undefined"&&d(x),o=="undefined"&&d(null)}n()},[s]),e.jsx("div",{className:"flex flex-col w-full gap-4 pt-4 pb-56",children:i[0]?i.map(n=>e.jsx(A,{message:n,loginUser:t,targetUser:s,avatar:l})):e.jsx(F,{targetUser:s,avatar:l})})},H=s=>g.get(s).then(({data:t})=>t).catch(t=>{console.log(t)}),O=(s,t,a,i)=>g.post(s,{user_id:t,targetUser_id:a,text:i}).then(({data:l})=>l).catch(l=>{console.log(l)}),G=({targetUser:s})=>{const t=r.useRef(),[a,i]=r.useState(""),l=v(),n=f(c=>c.ui).loginUser,x=c=>{c.preventDefault(),i("");const o=t.current.text.value,u="https://saeedwebdev.ir/api/messages";async function N(){const p=s[0]&&n[0]&&await O(u,n[0].id,s[0].id,o);p&&l(L(p))}N()};return e.jsxs("form",{onSubmit:c=>x(c),ref:t,className:"relative flex items-center justify-center border-[2px] w-full h-11 rounded-full",children:[e.jsx("input",{onChange:c=>i(c.target.value),value:a,type:"text",name:"text",placeholder:"پیام ...",className:"h-full w-full rounded-full px-12"}),a?e.jsxs("div",{className:"absolute right-3 text-[1.5rem] text-blue-600",children:[e.jsx("label",{htmlFor:"submit",children:e.jsx(S,{})}),e.jsx("input",{type:"submit",id:"submit",className:"hidden"})]}):e.jsx("i",{className:"absolute right-3 text-[1.5rem]",children:e.jsx(M,{})}),e.jsxs("div",{className:"absolute left-6 flex text-[1.5rem] gap-4",children:[e.jsx("i",{children:e.jsx($,{})}),e.jsx("i",{children:e.jsx(k,{})})]})]})},T=({targetUser:s,loginUser:t})=>e.jsxs("div",{className:"flex flex-col justify-between h-full xl:px-8 md:px-4 px-2",children:[e.jsx("div",{className:"flex h-full overflow-y-scroll",children:e.jsx(P,{targetUser:s,loginUser:t})}),e.jsx("div",{className:"sticky md:bottom-0 bottom-[60px] flex items-center justify-center h-fit py-3",children:e.jsx(G,{targetUser:s})})]}),D=({targetUser:s,loginUser:t})=>e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx(R,{targetUser:s}),e.jsx(T,{targetUser:s,loginUser:t})]}),V=()=>{const t=f(a=>a.ui).loginUser;return e.jsxs("div",{className:"sticky top-0 flex flex-col items-center w-full bg-white",children:[e.jsxs("div",{className:"flex justify-between w-full px-6 pt-6 pb-4",children:[e.jsx(j,{to:`/sma/chat/${targetUser[0]&&targetUser[0].id}`,children:t[0]&&t[0].firstName+" "+t[0].lastName}),e.jsx("i",{className:"text-2xl",children:e.jsx(I,{})})]}),e.jsxs("div",{className:"flex justify-between w-full px-6 py-2",children:[e.jsx("span",{children:"Messages"}),e.jsx("a",{href:"",children:"Requests"})]})]})},q=({user:s})=>{const[t,a]=r.useState(null);return r.useEffect(()=>{function i(){const l=new URL(Object.assign({"../../../../assets/avatar/testImg.png":h})[`../../../../assets/avatar/${s&&s.avatar}`],import.meta.url).href,d=l.split("/").length,n=l.split("/")[d-1];n!=="undefined"&&a(l),n=="undefined"&&a(null)}i()},[s]),e.jsxs("a",{href:`/sma/chat/${s.id}`,className:"flex items-center py-2 px-6 gap-4 hover:bg-bg-hover",children:[e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:t||m,alt:"",className:"w-full h-full rounded-full"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"-mt-1",children:s&&s.firstName+" "+s.lastName}),e.jsx("small",{children:"هیچ پیامی ارسال نشده است ."})]})]})},K=()=>{const s=f(l=>l.ui),t=s.allLoginUsers,a=s.loginUser,i=t&&t.filter(l=>l.id!==a[0].id);return e.jsx("div",{className:"overflow-y-scroll",children:i.map(l=>e.jsx(q,{user:l}))})},W=()=>e.jsxs("div",{className:"lg:flex hidden flex-col min-w-[360px] border-l-[1px] bg-white",children:[e.jsx(V,{}),e.jsx(K,{})]}),Z=()=>{const s=v(),[t,a]=r.useState(),l=f(c=>c.ui).loginUser,n=window.location.href.split("/"),x=n[n.length-1];return r.useEffect(()=>{async function c(){const o=`https://saeedwebdev.ir/api/users/${x}`,u=await _(o);u&&(a(u),s(E(u[0])))}c()},[x]),r.useEffect(()=>{async function c(){const o=t[0]&&l[0]&&await H(`https://saeedwebdev.ir/api/messages/${l[0].id}=${t[0].id}`);o&&s(B(o))}c()},[t]),e.jsx("section",{className:"flex w-full max-h-screen min-h-screen overflow-hidden",children:t&&l&&e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx(D,{targetUser:t,loginUser:l})]})})},X=C(Z);export{X as default};
