import{r as d,j as e,D as m,ac as S,ad as $,ae as M,L as v,i as u,g as N,u as w,Z as k,_ as B,$ as _,af as p,O as E,Q as L,ag as C}from"./index-ZnidFIX4.js";import{l as b,G as F,v as P,H as R}from"./index.esm-6gbWGAvM.js";import{c as A}from"./index.esm-RprHkUz5.js";const H=({targetUser:s})=>{const[l,t]=d.useState(null);return d.useEffect(()=>{function i(){const a=new URL(Object.assign({})[`../../../../assets/avatar/${s&&s[0].avatar}`],import.meta.url).href,f=a.split("/").length,x=a.split("/")[f-1];x!=="undefined"&&t(a),x=="undefined"&&t(null)}i()},[s]),e.jsxs("div",{className:"sticky top-0 flex items-center justify-between w-full min-h-[75px] xl:px-8 md:px-4 px-2 bg-white",children:[e.jsxs("div",{className:"flex items-center w-full gap-3",children:[e.jsx("div",{className:"w-[50px] h-[50px]",children:e.jsx("img",{src:s[0].avatar?`https://saeedwebdev.ir/avatar/${s[0].avatar}`:m,alt:"",className:"w-full h-full rounded-full"})}),e.jsx("span",{className:"-mt-1",children:s&&s[0].firstName+" "+s[0].lastName})]}),e.jsxs("div",{className:"flex gap-4 text-3xl",children:[e.jsx("i",{children:e.jsx(S,{})}),e.jsx("i",{children:e.jsx($,{})}),e.jsx("i",{children:e.jsx(M,{})})]})]})},D=({message:s,loginUser:l,targetUser:t})=>e.jsxs("div",{className:`flex ${s.user_id==l[0].id?"justify-end":"justify-start gap-2"} ${s.loading?"opacity-60":""} min-w-max`,children:[s.user_id!==l[0].id?e.jsx("div",{className:"w-[40px] h-[40px] ",children:e.jsx("img",{src:t[0].avatar?`https://saeedwebdev.ir/avatar/${t[0].avatar}`:m,alt:"",className:"object-cover h-full w-full rounded-full"})}):e.jsx(e.Fragment,{}),e.jsxs("p",{className:`relative max-w-[22rem] px-3 py-2 rounded-[1.5rem] break-words ${s.user_id==(l[0]&&l[0].id)&&l[0].id?"bg-blue-700 text-left text-white":"bg-gray-300"}`,children:[s.user_id==l[0].id&&e.jsx("span",{className:"absolute left-0 -top-4 min-w-max text-black text-[.7rem]",children:l[0]&&l[0].firstName+" "+l[0].lastName}),s.user_id!==l[0].id&&e.jsx("span",{className:"absolute right-3 -top-4 min-w-max text-black text-[.7rem]",children:t[0]&&t[0].firstName+" "+t[0].lastName}),s.text]})]}),G=({targetUser:s})=>e.jsxs("div",{className:"flex flex-col items-center w-full h-full pt-10 gap-2",children:[e.jsx("div",{className:"w-28 h-28",children:e.jsx("img",{src:s[0].avatar?`https://saeedwebdev.ir/avatar/${s[0].avatar}`:m,alt:"",className:"w-full h-full object-cover rounded-full"})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("span",{className:"flex justify-center",children:s&&s[0].firstName+" "+s[0].lastName}),e.jsx(v,{to:`/sma/profile/${s&&s[0].id}`,className:"flex py-2 px-4 bg-bg-hover rounded-[.5rem]",children:"View Profile"})]})]}),O=({targetUser:s,loginUser:l})=>{const i=u(a=>a.ui).allMessages;return e.jsxs("div",{className:"flex flex-col w-full gap-4 pt-4",children:[i[0]==""&&e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(b,{color:"black"})}),i[0]==""?"":i[0]=="no message"?e.jsx(G,{targetUser:s}):i.map(a=>e.jsx("span",{children:e.jsx(D,{message:a,loginUser:l,targetUser:s})},a.id)),e.jsxs("div",{className:"flex h-[120px] border-b-2 invisible",children:["sdfdfsdfs",e.jsx("br",{}),"sdfdfsdfs",e.jsx("br",{}),"sdfdfsdfs",e.jsx("br",{}),"sdfdsfdfs"]})]})},T=s=>N.get(s).then(({data:l})=>l).catch(l=>{console.log(l)}),I=(s,l,t,i)=>N.post(s,{user_id:l,targetUser_id:t,text:i}).then(({data:a})=>a).catch(a=>{console.log(a)}),V=({targetUser:s,setScroll:l})=>{const t=d.useRef(),[i,a]=d.useState(""),f=w(),n=u(c=>c.ui).loginUser,r=c=>{c.preventDefault(),a("");const o=t.current.text.value,h=P();f(p({text:o,user_id:n[0].id,loading:!0,id:h}));const g="https://saeedwebdev.ir/api/messages";async function y(){const j=s[0]&&n[0]&&await I(g,n[0].id,s[0].id,o);j&&f(p({text:j.text,user_id:n[0].id,loading:!1,id:h}))}y()};return e.jsxs("form",{onSubmit:c=>r(c),ref:t,className:"relative flex items-center justify-center border-[2px] w-full h-11 rounded-full",children:[e.jsx("input",{onChange:c=>a(c.target.value),value:i,type:"text",name:"text",placeholder:"پیام ...",className:"h-full w-full rounded-full px-12"}),i?e.jsxs("div",{className:"absolute right-3 text-[1.5rem] text-blue-600",children:[e.jsx("label",{htmlFor:"submit",children:e.jsx(k,{})}),e.jsx("input",{type:"submit",id:"submit",className:"hidden"})]}):e.jsx("i",{className:"absolute right-3 text-[1.5rem]",children:e.jsx(B,{})}),e.jsxs("div",{className:"absolute left-6 flex text-[1.5rem] gap-4",children:[e.jsx("i",{children:e.jsx(_,{})}),e.jsx("i",{children:e.jsx(F,{})})]})]})},q=({targetUser:s,loginUser:l})=>e.jsxs("div",{className:"flex flex-col justify-between h-full xl:px-8 md:px-4 px-2",children:[e.jsx("div",{id:"scroller",className:"flex h-full overflow-y-scroll",children:e.jsx(O,{targetUser:s,loginUser:l})}),e.jsx("div",{className:"sticky bottom-4 flex items-center justify-center h-fit",children:e.jsx(V,{targetUser:s})})]}),Q=({targetUser:s,loginUser:l})=>e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx(H,{targetUser:s}),e.jsx(q,{targetUser:s,loginUser:l})]}),W=()=>{const l=u(t=>t.ui).targetUser;return e.jsxs("div",{className:"sticky top-0 flex flex-col items-center w-full bg-white",children:[e.jsxs("div",{className:"flex justify-between w-full px-6 pt-6 pb-4",children:[e.jsx(v,{to:`/sma/chat/${l[0]&&l[0].id}`,children:l[0]&&l[0].firstName+" "+l[0].lastName}),e.jsx("i",{className:"text-2xl",children:e.jsx(A,{})})]}),e.jsxs("div",{className:"flex justify-between w-full px-6 py-2",children:[e.jsx("span",{children:"Messages"}),e.jsx("a",{href:"",children:"Requests"})]})]})},Z=({user:s})=>e.jsxs("a",{href:`/sma/chat/${s.id}`,className:"flex items-center py-2 px-6 gap-4 hover:bg-bg-hover",children:[e.jsx("div",{className:"w-14 h-14",children:e.jsx("img",{src:s.avatar?`https://saeedwebdev.ir/avatar/${s.avatar}`:m,alt:"",className:"w-full h-full rounded-full"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"-mt-1",children:s&&s.firstName+" "+s.lastName}),e.jsx("small",{children:"هیچ پیامی ارسال نشده است ."})]})]}),z=()=>{const s=u(a=>a.ui),l=s.allLoginUsers,t=s.loginUser,i=l&&l.filter(a=>a.id!==t[0].id);return e.jsx("div",{className:"overflow-y-scroll",children:i.map(a=>e.jsx("span",{children:e.jsx(Z,{user:a})},a.id))})},J=()=>e.jsxs("div",{className:"lg:flex hidden flex-col min-w-[360px] border-l-[1px] bg-white",children:[e.jsx(W,{}),e.jsx(z,{})]}),K=()=>{const s=w(),[l,t]=d.useState(),a=u(r=>r.ui).loginUser,x=window.location.href.split("/"),n=x[x.length-1];return d.useEffect(()=>{async function r(){const c=`https://saeedwebdev.ir/api/users/${n}`,o=await E(c);o&&(t(o),s(L(o[0])))}r()},[n]),d.useEffect(()=>{async function r(){const c=l&&a[0]&&await T(`https://saeedwebdev.ir/api/messages/${a[0].id}=${l[0].id}`);c&&s(C(c))}r()},[l]),e.jsx("section",{className:"flex w-full max-h-screen min-h-screen overflow-hidden",children:l&&a?e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(Q,{targetUser:l,loginUser:a})]}):e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx(b,{color:"black"})})})},ee=R(K);export{ee as default};
